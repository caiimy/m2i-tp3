---
# .github/workflows/pipeline.yml

name: CI Pipeline
 
on: push
 
jobs:
  git:
    name: checkout code
    uses: actions/checkout@v2
    with:
      ref: master # Nom de la branche 
    
  lint:
 
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install dependencies
      run: pip install pylint
 
    - name: Lint code
      run: pylint **/*.py --output-format=text
 
    - name: Save lint report
      uses: actions/upload-artifact@v1
      with:
        name: pylint-report
        path: pylint-report.txt

  duplicate:
 
    needs: lint
    runs-on: ubuntu-latest
 
    steps:
    - uses: actions/checkout@v2
    - name: Install dependencies
      run: pip install clone_detector
 
    - name: Check duplicates
      run: clone_detector --output-file=duplicate-report.txt
 
    - name: Save duplicate report
      uses: actions/upload-artifact@v1
      with:
        name: duplicate-report
        path: duplicate-report.txt
 
  cyclomatic:
 
    needs: [lint, duplicate]
 
    runs-on: ubuntu-latest
 
    steps:
    - uses: actions/checkout@v2
    - name: Install dependencies
      run: pip install radon
 
    - name: Check complexity
      run: radon cc -s -a -nb --total-average .
 
    - name: Save complexity report
      uses: actions/upload-artifact@v1
      with: 
        name: complexity-report
        path: complexity-report.txt
 
  test:
 
    needs: cyclomatic
 
    runs-on: ubuntu-latest
 
    steps:
    - uses: actions/checkout@v2
    - name: Install dependencies
      run: pip install -r requirements.txt
 
    - name: Run tests
      run: python -m unittest discover
 
    - name: Save test report
      uses: actions/upload-artifact@v1
      with:
        name: test-report
        path: test-report.xml
 
  build:
 
    needs: test
 
    runs-on: ubuntu-latest
 
    steps:
 
    - uses: actions/checkout@v2
 
    - name: Login to Docker Hub
      uses: docker/login-action@v1
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
 
    - name: Build image
      run: docker build . --file Dockerfile --tag myimage:$(date +%s)
 
    - name: Push image
      run: docker push myimage:$(date +%s)
---
